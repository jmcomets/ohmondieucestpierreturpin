"use strict";(function(){var t=function(){this.a={};this.b={};this.c={d:[],e:[]}};t.prototype.f=function(){this.a={}};t.prototype.g=function(t){for(var i=0;i<t.length;i++){this.a[t[i]]=true}};t.prototype.h=function(t){var i=this;var a=function(t,a){var s=i.c[t];for(var n=0;n<s.length;n++){s[n](a)}};t.on("keydown",function(t){var s=t.which;if(i.b[s]){return}i.b[s]=true;if(i.a[s]){a("press",s)}});t.on("keyup",function(t){var s=t.which;i.b[s]=false;if(i.a[s]){a("release",s)}})};t.prototype.i=function(t){this.c.d.push(t)};t.prototype.j=function(t){this.c.e.push(t)};var i=function(t,i){this.k=t;this.l=i;this.c=[];this.m="";this.n=this.o();this.p()};i.prototype.q=function(t){this.n.q(t)};i.prototype.r=function(t){this.c.push(t)};i.prototype.s=function(t){var i=this;for(var a=0;a<i.c.length;a++){i.c[a](i.k,t)}};i.prototype.t=function(){this.m="";this.p()};i.prototype.u=function(t){this.m=t;this.p()};i.prototype.p=function(){var t=["btn","btn-default","btn-lg"];this.n.attr("class",t.join(" "));if(this.m){this.n.addClass("btn-"+this.m)}};i.prototype.o=function(){var t=this;var i=$('<button type="button"></button>');i.html('<span class="pull-left">['+t.k+"]</span>"+t.l);i.on("mousedown",function(){t.s("press")});i.on("mouseup",function(){t.s("release")});return i};var a=function(t){this.c=[];this.v=t};a.prototype.w=function(t,i){this.x=i;this.y=t;this.z={};this.A();this.p()};a.prototype.t=function(t){var i=this.B[t];if(i){this.C(t);i.t()}};a.prototype.p=function(){var t=$("<div></div>");t.addClass("btn-group-vertical");for(var i in this.B){this.B[i].q(t)}this.v.html("");t.q(this.v)};a.prototype.u=function(t,i){var a=this.B[t];if(a){this.C(t);a.u(i)}};a.prototype.C=function(t){var i=this.z[t];if(i){clearTimeout(i);this.z[t]=undefined}};a.prototype.D=function(t,i){this.u(t,i);var a=2;var s=this;this.z[t]=setTimeout(function(){s.t(t)},a*1e3)};a.prototype.F=function(t,i){var a=t-this.x;if(i=="press"){this.s(a)}else{this.t(a)}};a.prototype.s=function(t){for(var i=0;i<this.c.length;i++){this.c[i](t)}};a.prototype.r=function(t){this.c.push(t)};a.prototype.G=function(){var t=[];for(var i in this.B){i=parseInt(i);t.push(this.x+i)}return t};a.prototype.A=function(){var t=this;t.B={};for(var a in t.y){a=parseInt(a);var s=new i(a,t.y[a]);s.r(function(i,a){t.F(t.x+i,a)});t.B[a]=s}};var s=function(t){this.H=[];this.I=t};s.prototype.J=function(t){this.K=t};s.prototype.L=function(t){for(var i=0;i<this.K.length;i++){var a=$("<source />").attr("src",this.K[i].src).attr("type",this.K[i].M);this.I.append(a)}this.N=this.I.get(0);this.I.on("contextmenu",function(t){return false});this.N.O=function(){t()};if(this.N.readyState>3){this.N.O=null;t()}this.N.P();this.N.play();this.N.pause()};s.prototype.Q=function(){this.N.play();var t=this;this.N.addEventListener("ended",function(){t.R()},false)};s.prototype.R=function(t){for(var i=0;i<this.H.length;i++){this.H[i]()}};s.prototype.S=function(t){this.H.push(t)};s.prototype.T=function(){this.N.play();this.N.U=0};function n(){return(new Date).getTime()}var o=function(){this.V=-1;this.W=-1;this.c={X:[],Y:[]};this.Z=0};o.prototype.w=function(t){this.$=t;this.$*=1e3};o.prototype._=function(t){this.aa=t};o.prototype.Q=function(){this.Z=n();this.ba()};o.prototype.T=function(){if(this.W!=-1){clearTimeout(this.W);this.W=-1}this.V=-1;this.Q()};o.prototype.ca=function(t){var i=this.da();var a=this.aa[this.V];if(a&&t==a.k&&Math.abs(i-a.time)<=this.$){this.Y(t)}else{this.X(t)}};o.prototype.da=function(){return n()-this.Z};o.prototype.ba=function(){this.V++;if(this.V<this.aa.length){var t=this.aa[this.V];var i=this.da();var a=t.time-i+this.$;if(a>0){var s=this;this.W=setTimeout(function(){s.X(t.k)},a)}else{console.error("could not set timeout, negative time")}}else{}};o.prototype.Y=function(t){if(this.W!=-1){clearTimeout(this.W);this.W=-1;this.s("success",t)}};o.prototype.X=function(t){this.s("cancel",t)};o.prototype.s=function(t){var i=Array.prototype.slice.call(arguments);i=i.slice(1,i.length);var a=this.c[t];for(var s=0;s<a.length;s++){var n=a[s];n.apply(n,i)}};o.prototype.ea=function(t){this.c.Y.push(t)};o.prototype.fa=function(t){this.c.X.push(t)};function e(t,i,a){$.ajax({M:"POST",ga:t,ha:"application/json",ia:"json",ja:JSON.stringify(i),Y:a})}var h=function(t){this.ka=t;this.la=0;this.ma=-1;this.na=-1;this.oa=-1;this.pa="";this.qa=-1;this.ra=1;this.sa=8};h.prototype.w=function(t,i,a){this.y=t;this.ta=i;this.ua=a};h.prototype.va=function(t){this.wa=t};h.prototype.xa=function(){var t=this;var i=function(){t.P(function(){t.p();t.qa=setTimeout(i,t.ua*1e3)})};i()};h.prototype.P=function(t){var i=this;$.getJSON("/score",function(a){i.pa=a["ya"];i.ma=Math.floor(a["high_score"]);i.oa=Math.floor(a["average_score"]);i.na=Math.floor(a["most_failed"]);t()})};h.prototype.Y=function(t){var i=this.ta[t];if(i){this.la+=i*this.ra;this.p()}};h.prototype.X=function(t){var i=this.ta[t];e("/score",{wa:this.wa,za:this.la,Aa:t});this.la=0;this.ra=1;this.p()};h.prototype.Ba=function(){this.ra*=2;if(this.ra>this.sa){this.ra=this.sa}};h.prototype.p=function(){var t=this.y[this.na];if(t!==undefined){this.ka.na.l(t)}var i=this.la>this.ma;var a=i?this.la:this.ma;var s=i?this.wa:this.pa;this.ka.ma.attr("class","label label-as-badge");if(i){this.ka.ma.addClass("label-success")}else{this.ka.ma.addClass("label-default")}var n=a;if(s){n+=" ("+s+")"}this.ka.ma.l(n);var o=this.la>this.oa;this.ka.oa.attr("class","label label-as-badge");if(o){this.ka.oa.addClass("label-warning")}else{this.ka.oa.addClass("label-default")}this.ka.oa.l(this.oa);this.ka.Ca.attr("class","label label-as-badge");this.ka.Ca.l(this.la);this.ka.Da.attr("class","label label-as-badge");this.ka.Da.l(this.ra)};var r=function(i){this.Ea=new s(i.N);this.Fa=new a(i.Fa);this.Ga=new t;this.Ha=new o;this.Ia=new h(i.Ja);var n=this;this.Ga.i(function(t){n.Fa.F(t,"press")});this.Ga.j(function(t){n.Fa.F(t,"release")});this.Ga.h(i.aa);this.Ea.S(function(){n.Ka()});this.Fa.r(function(t){n.Ha.ca(t)});this.Ha.ea(function(t){n.ea(t)});this.Ha.fa(function(t){n.fa(t)})};r.prototype.Q=function(){this.Ea.Q();this.Ia.xa();this.Ha.Q()};r.prototype.va=function(t){this.Ia.va(t)};r.prototype.La=function(t){var i=this;this.Ma(function(a){i.Fa.w(a.y,a.x);i.Ga.g(i.Fa.G());i.Ha.w(a.$);i.Ha._(a.aa);i.Ia.w(a.y,a.ta,a.ua);i.Ea.J(a.K);t()})};r.prototype.Ka=function(){this.Ia.Ba();this.T()};r.prototype.T=function(){this.Ea.T();this.Ha.T()};r.prototype.ea=function(t){this.Fa.u(t,"success");this.Ia.Y(t);this.Ha.ba()};r.prototype.fa=function(t){this.Fa.D(t,"danger");this.Ia.X(t);this.T()};r.prototype.L=function(t){this.Ea.L(t)};r.prototype.Ma=function(t){$.getJSON("/settings",function(i){t(i)})};$(function(){$(".btn").on("mouseup",function(){$(this).blur()});var t=new r({Fa:$("#controls"),aa:$(window),N:$("#video"),Ja:{oa:$("#average-score"),Da:$("#current-combo"),Ca:$("#current-score"),ma:$("#high-score"),na:$("#most-failed")}});var i=$("#loadingStep");i.show();var a=3*1e3;var s=.5*1e3;var n=.4*1e3;var o=.8*1e3;t.La(function(){i.fadeOut(n,function(){var a=$("#loginStep");a.animate({Na:"0%"},o,function(){var e=$("#nickname-form");var h=$("#nickname");e.one("submit",function(e){var r=$.trim(h.val());if(!r){return false}t.va(r);a.animate({Na:"-100%"},o);i.fadeIn();t.L(function(){i.fadeOut(n,function(){$("#flashStep").fadeIn(n).delay(s).fadeOut(n,function(){var i=$("#gamePanel");i.fadeIn(n,function(){t.Q()})})})});e.preventDefault()})})})})})})();
//# sourceMappingURL=main.min.js.map
